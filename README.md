# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build

```

# Данные и типы данных, используемые в приложении


***Интерфейс карточки***

```

export interface ICard {
	id: string;
	description?: string;
	image: string;
	title: string;
	category: categoryType;
	price: number | null;
	disabled?: boolean;
}

```

***Интерфейс заказа***

```

export interface IOrder {
	payment?: string;
	email?: string;
	phone?: string;
	address?: string;
	total: number;
	items: string[];
}

```

***Интерфейс страницы***

```

export interface IPage {
	counter: number;
	catalog: HTMLElement[];
	locked: boolean;
}

```

***Интерфейс состояния приложения***

```

export interface IAppState {
	catalog: ICard[];
}

```

***Интерфейс действий с карточкой***

```

export interface ICardActions {
	onClick: (event: MouseEvent) => void;
}

```

***Интерфейс ответа от сервера***

```

export interface IServerResponse {
	items: ICard[];
}

```

***Интерфейс корзины товаров***

```

export interface IBasketView {
	items: HTMLElement[];
	price: number;
}

```

***Интерфейс элемента в корзине***

```

export interface IBasketItem {
	number: number;
	title: string;
	price: number;
}

```

***Интерфейс ошибок***

```

export type FormErrors = Partial<Record<keyof IOrder, string>>;

```

***Интерфейс формы заказа***

```

export interface IOrderForm {
	payment: string;
	address: string;
	email: string;
	phone: string;
}

```

***Интерфейс данных пользователя***

```

export interface IContacts {
	phone: string;
	email: string;
}

```
## Архитектура

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

**Класс API**

Предоставляет базовый функционал для выполнения HTTP-запросов. В конструкторе устанавливается базовый URL и настраиваются опции для запросов. Методы `get` и `post` выполняют GET и POST запросы соответственно, обрабатывая ответы через метод `handleResponse`. Класс обеспечивает удобный способ взаимодействия с API и получения данных из сервера.	

**Класс EventEmitter**

Обеспечивает управление событиями и подписчиками на эти события. В классе определены методы для установки обработчика на событие (`on`), удаления обработчика с события (`off`), инициирования события с передачей данных (`emit`). Также есть методы для установки обработчика для всех событий (`onAll`), удаления всех обработчиков (`offAll`) и создания триггера, который генерирует событие при вызове (`trigger`). Класс `EventEmitter` позволяет удобно управлять событиями в приложении, подписываться на них, генерировать и удалять обработчики.

**Абстрактный класс Model**

Этот класс представляет базовую модель, которая может использоваться для создания конкретных моделей с различным содержимым и функционалом. Он также позволяет модели сообщать об изменениях и генерировать события для уведомления об этих изменениях в приложении.

**Абстрактный класс Component**

Данный класс предоставляет удобные методы для работы с DOM элементами внутри компонентов и упрощает разработку пользовательского интерфейса, позволяя создавать и управлять компонентами на веб-странице. Класс `Component` может быть использован как базовый класс для других компонентов в приложении, обеспечивая им общий функционал для работы с DOM.

### Слой данных

**Класс AppModelData**

Класс представляет модель данных приложения и содержит различные методы для управления этими данными, а также взаимодействия с событиями через объект `events`.

В данном классе определены следующие свойства и методы:

1. Свойства:
- `catalog`: массив объектов модели `CardModel`, представляющих карточки товаров в каталоге.
- `preview`: строковое значение, представляющее идентификатор предпросмотра товара.
- `basket`: массив объектов товаров `ICard`, представляющих товары в корзине.
- `order`: объект `IOrder` с информацией о заказе.
- `formErrors`: объект `FormErrors` с ошибками валидации формы заказа.

2. Методы:
- `setCatalog(items)`: устанавливает каталог товаров, создавая объекты `CardModel` на основе переданных данных и генерирует событие об изменении каталога.
- `setPreview(item)`: устанавливает предпросмотр товара и генерирует событие об изменении предпросмотра.
- `addToBasket(value)`: добавляет товар в корзину.
- `getBasketAmount()`: возвращает количество товаров в корзине.
- `getTotalBasketPrice()`: вычисляет общую стоимость товаров в корзине.
- `deleteFromBasket(id)`: удаляет товар из корзины.
- `validateContacts()`: валидирует контактную информацию пользователя и генерирует событие об изменении ошибок формы контактов.
- `validateOrder()`: валидирует информацию о заказе и генерирует событие об изменении ошибок формы заказа.
- `setOrderField(field, value)`: устанавливает значение поля в заказе, валидирует заказ и контактную информацию, и генерирует события о готовности заказа и контактов.

### Слой представления

**Класс Basket**

Класс является компонентом корзины в интерфейсе приложения. Он отвечает за отображение списка товаров в корзине, общей стоимости и управление кнопкой оформления заказа. Класс содержит свойства для элементов корзины, цены и кнопки, а также методы для установки товаров, общей стоимости, доступности кнопки и перенумерации элементов. Класс работает с событиями через объект `events` для уведомления о необходимых изменениях.

**Класс BasketItem**

Класс представляет элемент товара в корзине на веб-странице. Класс расширяет функциональность базового класса `Component` и содержит элементы товара (номер, название, цена, кнопка). В конструкторе класса инициализируются элементы товара и устанавливается обработчик события клика на кнопку. При клике на кнопку, элемент товара удаляется из корзины, и вызывается метод `onClick`, если он был передан. Методы `set title`, `set number`, `set price` устанавливают значения названия, номера и цены товара соответственно.

**Класс Form**

Класс представляет компонент формы в интерфейсе приложения. Он содержит элементы формы, такие как кнопка отправки и область для отображения ошибок. Класс управляет вводом данных в форму, проверкой их на валидность, выводом ошибок и отправкой данных формы. Кроме того, класс реагирует на события ввода данных и отправки формы, используя объект `events` для работы с событиями. Методы класса позволяют устанавливать доступность кнопки отправки в зависимости от валидности данных, отображать сообщения об ошибках и рендерить текущее состояние формы.

**Класс Modal**

Класс представляет модальное окно на веб-странице. Он содержит элементы окна (кнопка закрытия и содержимое) и методы для открытия, закрытия и изменения содержимого модального окна. Класс также взаимодействует с событиями для управления состоянием модального окна.

**Класс Success** 

Класс представляет компонент для отображения уведомления об успешном действии на веб-странице. Он содержит кнопку закрытия и элемент для отображения описания успешного действия. Класс обеспечивает метод `set description`, который позволяет установить описание успешного действия. Также в конструкторе устанавливается прослушивание события клика на кнопке закрытия, если такое действие передано в параметрах.

**Класс Card**

Класс представляет компонент карточки товара на веб-странице. Он содержит элементы карточки (изображение, заголовок, категория, цена, кнопка) и методы для установки и обновления их значений. Класс позволяет устанавливать заголовок, категорию, цену, изображение и доступность кнопки карточки. Конструктор класса инициализирует элементы карточки и устанавливает прослушивание события клика на кнопке, если переданы обработчики событий.

**Класс Order**

Класс представляет форму заказа на веб-странице. Он расширяет функциональность базового класса `Form` и содержит элементы формы (кнопки выбора оплаты, поле адреса и кнопка отправки заказа). В конструкторе класса инициализируются элементы формы и устанавливаются обработчики событий. При нажатии на кнопку отправки заказа, происходит открытие контактов, сброс состояния кнопок выбора оплаты и очистка поля адреса. Также устанавливаются обработчики событий для кнопок выбора оплаты: при выборе оплаты наличными или картой устанавливается активное состояние кнопки и вызывается функция обработки ввода.

**Класс Contacts**

Класс представляет форму контактов на веб-странице. Класс расширяет функциональность базового класса `Form` и содержит кнопку отправки контактов. В конструкторе класса инициализируется кнопка отправки контактов и устанавливается обработчик события клика на кнопке. При нажатии на кнопку отправки, происходит отправка события `order:send`, а также очищаются поля email и phone в форме контактов.

**Класс Page**

Класс представляет компонент страницы на веб-сайте. Класс расширяет функциональность базового класса `Component` и содержит элементы страницы (счетчик корзины, каталог товаров, обертка страницы, корзина). В конструкторе класса инициализируются элементы страницы и устанавливается обработчик события клика на корзину. При клике на корзину, отправляется событие `bids:open`. Метод `set catalog` устанавливает элементы в каталоге товаров. Метод `set locked` блокирует или разблокирует обертку страницы в зависимости от переданного значения. Метод `set counter` устанавливает значение в счетчике корзины.

### Взаимодействие

Файл `index.ts` выполняет роль презентера взаимодействия между представлением и данными. В этом файле создаются экземпляры классов, необходимых для функционирования программы, и настраивается обработка событий за счет использования брокера событий и соответствующих обработчиков. Вся логика взаимодействия между элементами веб-страницы организуется через генерацию и обработку событий.
